name: Blog Auto Generate

on:
  schedule:
    # Îß§ÏãúÍ∞Ñ 00Î∂ÑÏóê Ïã§Ìñâ (UTC ÏãúÍ∞Ñ)
    # UTC 0Ïãú = ÌïúÍµ≠ ÏãúÍ∞Ñ 9Ïãú
    - cron: '0 * * * *'
  workflow_dispatch: # ÏàòÎèô Ïã§Ìñâ Í∞ÄÎä•
  push:
    branches:
      - master
    paths:
      - '.github/workflows/blog-cron.yml'

jobs:
  generate-blog:
    runs-on: ubuntu-latest
    steps:
      - name: Call Blog Generate API
        run: |
          echo "====================================="
          echo "Î∏îÎ°úÍ∑∏ ÏûêÎèô ÏÉùÏÑ± Cron Ïã§Ìñâ"
          echo "Ïã§Ìñâ ÏãúÍ∞Å: $(date)"
          echo "UTC: $(date -u)"
          echo "====================================="
          echo ""
          
          response=$(curl -s -w "\n%{http_code}" -X GET "https://dawn-housing.vercel.app/api/cron/blog-auto-generate")
          http_code=$(echo "$response" | tail -n1)
          body=$(echo "$response" | sed '$d')
          
          echo "üìä API ÏùëÎãµ:"
          echo "  HTTP Status: $http_code"
          echo "  Response Body:"
          echo "$body" | jq '.' 2>/dev/null || echo "$body"
          echo ""
          
          if [ "$http_code" -eq 200 ]; then
            echo "‚úÖ Î∏îÎ°úÍ∑∏ ÏÉùÏÑ± API Ìò∏Ï∂ú ÏÑ±Í≥µ"
            
            # ÏùëÎãµÏóêÏÑú success ÌïÑÎìú ÌôïÏù∏
            success=$(echo "$body" | jq -r '.success' 2>/dev/null)
            if [ "$success" = "true" ]; then
              echo "üéâ Î∏îÎ°úÍ∑∏ Ìè¨Ïä§Ìä∏ ÏÉùÏÑ± ÏôÑÎ£å!"
              echo "  Ï†úÎ™©: $(echo "$body" | jq -r '.result.title' 2>/dev/null)"
            else
              echo "‚è∞ $(echo "$body" | jq -r '.message' 2>/dev/null)"
            fi
          else
            echo "‚ö†Ô∏è API Ìò∏Ï∂ú ÏôÑÎ£å (HTTP $http_code)"
            exit 1
          fi

